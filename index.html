<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta charset="utf-8" />
	<!-- Bootstrap -->
	<link href="static/css/all.min.css" rel="stylesheet" type="text/css" />
	<link href="static/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<!-- Dashboard -->
	<link href="static/css/dashboard.css" rel="stylesheet" type="text/css" />
</head>

<body>
	<div class="container-fluid mt-2" id="app">
		<!-- navigation bar -->
		<nav class="navbar bg-info">
			<a class="navbar-brand text-white">{{ title }}</a>
			<form class="form-inline">
				<button :class="['btn btn-sm  my-2 my-sm-0 text-white ', filtered ? 'active' : '' ]" type="button"
					@click="onFilter($event)" style="margin-right: 0px">
					<img src="static/images/filter-icon-16.png" /> {{ filtered ? 'Hide Filter' : 'Show Filter' }}
				</button>

				<div class="btn-group">
					<button type="button" class="btn btn-sm btn-info text-white dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" @click="onChangeSettings($event)">
						<img src="static/images/cogs-icon-16.png" /> 
						Settings
					</button>
					<ul :class="['dropdown-menu checkbox-menu bg-info allow-focus mt-3 dropdown-menu-right ', settings.show ? 'show' : 'hide']">
						<li >
							<label>
								<input type="checkbox" v-model="settings.showMore"> <span class="smal text-white"> Show more</span> 
							</label>
						</li>
						<li >
							<label>
								<input type="checkbox" v-model="settings.showPhaseName"> <span class="smal text-white"> Show phase name</span> 
							</label>
						</li>
					</ul>
			</form>
		</nav>
		<!-- end navigation bar -->

		<!-- filter -->
		<div class="row" v-if="filtered">
			<div class="col">
				<div class="text-center" v-if="isVssReady === false">
					<img class="img-fluid" width="120" src="static/images/loading.gif" />
				</div>

				<form>
					<div class="form-group input-group-sm mt-2">
						<input id="filterContent" name="filterContent" type="text" class="form-control input-sm" id="searchFor" aria-describedby="searchFor" v-model="filterContent" placeholder="Search">
						<small id="emailHelp" class="form-text text-muted" >Example: MH BIZ 2.66.0 or 2.66 or vNext - DEV BIZ</small>
					</div>
					<div class="form-group">
						<div class="accordion" id="accordions" v-if="isVssReady === true">
							<div class="card mt-1" v-for="application in apps">
								<div class="card-header pt-0" :id="application.id">
									<div class="row  pt-2">
										<div class="col">
											<button class="btn btn-link btn-sm font-weight-bold" :class="'text-'+application.color" type="button" data-toggle="collapse"
												:id="application.id" @click="onAppClick($event)"
												:data-target="application.id" aria-expanded="true"
												:aria-controls="application.id">
													{{application.title}}													
											</button>
										</div>
										<div class="col text-right">
											<button :id="application.id" type="button" class="btn btn-info btn-sm" @click="onCheckItems($event)">
												{{ application.checkItems ? "Uncheck all" : "Check all" }}
											</button>
										</div>
									</div>								
								</div>

								<div :id="application.id"
									v-bind:class="['collapse ', application.visible ? 'show' : '']"
									:aria-labelledby="application.id" data-parent="#accordions">
									<div class="card-body">
										<transition name="fade">
											<div class="card-body bg-light">
												<div class="row">
													<div class="col text-center"
														v-if="!application.isReleaseListLoaded">
														<img class="img-fluid" width="120"
															src="static/images/loading.gif" />
													</div>
													<div class="col-3" v-if="application.isReleaseListLoaded"
														v-for="release in application.releaseList" >
														<div class="custom-control custom-checkbox">
															<input type="checkbox" class="custom-control-input"  v-model="checkedReleases" :value="release.definitionName" :id="release.definitionId" >
															<label class="custom-control-label text-dark"
																:for="release.definitionId">{{release.definitionName}}</label>
														</div>
													</div>
												</div>
											</div>
										</transition>
									</div>
								</div>

							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<!-- end filter -->

		<div id="dashboard" class="table-wrapper-scroll-y my-custom-scrollbar mt-2">
			<table id="table-cards" class="table table-sm" cellspacing="0" width="100%">
				<thead>
					<tr>
						<th scope="col">Development</th>
						<th scope="col">Quality</th>
						<th scope="col">Staging</th>
						<th scope="col">Production</th>
					</tr>
				</thead>
				<tbody>
					<tr v-for="(card, cardIndex) in filteredCards">
						<td>
							<div :id="card.devCardId" class="card card-options" :class="{ 'card-light' : cardIndex % 2 === 0 }" >
								<div class="card-body2">
									<div class="row">
										<div class="col">
											<a :href="card.content.dev.length > 0 ? card.content.dev[0].uriReleaseLink : ''" target="_blank" class="card-title">
												<span :class="card.badgeClassName">{{card.releaseTitle}}</span>
											</a>
										</div>
										<div class="col text-xs-center text-sm-center text-right" v-if="settings.showMore && (card.content.dev.length !== card.content.devFull.length)">
											<a class="text-primary" @click="onShowMoreClick($event, 'dev')" class="card-title">
												<span :cardid="card.id">{{ card.content.devShowMore ? 'Show less' : 'Show more' }}</span>
											</a>
										</div>									
									</div>
									<table class="table table-hover table-borderless table-fixed">
										<tbody>
											<tr v-for="item in card.content.devShowMore ? card.content.devFull : card.content.dev">
												<td>
													<a class="dashboard-release" :href="item.uriReleasePipeline" target="_blank">
														{{item.releaseText}}
														<br v-if="settings.showPhaseName">
														<small class="text-muted" v-if="settings.showPhaseName">{{item.environmentFullName}}</small>
													</a>
												</td>
												<td>
													<div class="align-top text-nowrap">
														<i :class="item.statusIconClass"></i>
														<span :class="item.statusTextClass">{{item.statusText}}</span>
													</div>
												</td>
												<td>
													<a :bc="card.app.color" :bid="item.buildId" :rt="item.releaseText" class="far align-top fa-clipboard dashboard-card-icon" @click="onReleaseItemClick($event)"></a>
												</td>
											</tr>
										</tbody>										
									</table>
								</div>
							</div>
						</td>
						<td>
							<div :id="card.qaCardId" class="card card-options" :class="{ 'card-light' : cardIndex % 2 === 0}">
								<div class="card-body2">
									<div class="row">
										<div class="col">
											<a :href="card.content.qa.length > 0 ? card.content.qa[0].uriReleaseLink : ''" target="_blank" class="card-title">
												<span :class="card.badgeClassName">{{card.releaseTitle}}</span>
											</a>
										</div>
										<div class="col text-xs-center text-sm-center text-right" v-if="card.content.qa.length !== card.content.qaFull.length">
											<a class="text-primary" @click="onShowMoreClick($event, 'qa')" class="card-title">
												<span :cardid="card.id">{{ card.content.devShowMore ? 'Show less' : 'Show more' }}</span>
											</a>
										</div>									
									</div>
									<table class="table table-hover table-borderless table-fixed">
										<tbody>
											<tr v-for="item in card.content.qaShowMore ? card.content.qaFull : card.content.qa">
												<td>
													<a class="dashboard-release" :href="item.uriReleasePipeline" target="_blank">
														{{item.releaseText}}
													</a>
													<br>
													<small class="text-muted">{{item.environmentFullName}}</small>
												</td>
												<td>
													<div class="align-top text-nowrap">
														<i :class="item.statusIconClass"></i>
														<span :class="item.statusTextClass">{{item.statusText}}</span>
													</div>
												</td>
												<td>
													<a :bc="card.app.color" :bid="item.buildId" :rt="item.releaseText" class="far align-top fa-clipboard dashboard-card-icon" @click="onReleaseItemClick($event)"></a>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</td>
						<td>
							<div :id="card.stgCardId" class="card card-options" :class="{ 'card-light' : cardIndex % 2 === 0}">
								<div class="card-body2">
									<div class="row">
										<div class="col">
											<a :href="card.content.stg.length > 0 ? card.content.stg[0].uriReleaseLink : ''" target="_blank" class="card-title">
												<span :class="card.badgeClassName">{{card.releaseTitle}}</span>
											</a>
										</div>
										<div class="col text-xs-center text-sm-center text-right" v-if="card.content.stg.length !== card.content.stgFull.length">
											<a class="text-primary" @click="onShowMoreClick($event, 'stg')" class="card-title">
												<span :cardid="card.id">{{ card.content.devShowMore ? 'Show less' : 'Show more' }}</span>
											</a>
										</div>
									</div>
									<table class="table table-hover table-borderless table-fixed">
										<tbody>
											<tr v-for="item in card.content.stgShowMore ? card.content.stgFull : card.content.stg">
												<td>
													<a class="dashboard-release" :href="item.uriReleasePipeline" target="_blank">
														{{item.releaseText}}
													</a>
													<br>
													<small class="text-muted">{{item.environmentFullName}}</small>
												</td>
												<td>
													<div class="align-top text-nowrap">
														<i :class="item.statusIconClass"></i>
														<span :class="item.statusTextClass">{{item.statusText}}</span>
													</div>
												</td>
												<td>
													<a :bc="card.app.color" :bid="item.buildId" :rt="item.releaseText" class="far align-top fa-clipboard dashboard-card-icon" @click="onReleaseItemClick($event)"></a>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</td>
						<td>
							<div :id="card.prdCardId" class="card card-options" :class="{ 'card-light' : cardIndex % 2 === 0}">
								<div class="card-body2">
									<div class="row">
										<div class="col">
											<a :href="card.content.prd.length > 0 ? card.content.prd[0].uriReleaseLink : ''" target="_blank" class="card-title">
												<span :class="card.badgeClassName">{{card.releaseTitle}}</span>
											</a>
										</div>
										<div class="col text-xs-center text-sm-center text-right" v-if="card.content.prd.length !== card.content.prdFull.length">
											<a class="text-primary" @click="onShowMoreClick($event, 'prd')" class="card-title">
												<span :cardid="card.id">{{ card.content.prdShowMore ? 'Show less' : 'Show more' }}</span>
											</a>
										</div>
									</div>
									<table class="table table-hover table-borderless table-fixed">
										<tbody>
											<tr v-for="item in card.content.prdShowMore ? card.content.prdFull : card.content.prd">
												<td>
													<a class="dashboard-release" :href="item.uriReleasePipeline" target="_blank">
														{{item.releaseText}}
													</a>													
													<br>
													<small class="text-muted">{{item.environmentFullName}}</small>
												</td>
												<td>
													<div class="align-top text-nowrap">
														<i :class="item.statusIconClass"></i>
														<span :class="item.statusTextClass">{{item.statusText}}</span>
													</div>
												</td>
												<td>
													<a :bc="card.app.color" :bid="item.buildId" :rt="item.releaseText" class="far align-top fa-clipboard dashboard-card-icon" @click="onReleaseItemClick($event)"></a>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<!-- Bootstrap -->
	<script src="lib/bootstrap.min.js" type="text/javascript"></script>
	<!-- VSS SDK -->
	<script src="lib/VSS.SDK.min.js" type="text/javascript"></script>
	<!-- Vue -->
	<script src="lib/Vue.js" type="text/javascript"></script>
	<!-- Loadash SDK -->
	<script src="lib/lodash.min.js" type="text/javascript"></script>
	<!-- Loadash Axios -->
	<script src="lib/axios.min.js" type="text/javascript"></script>
	<!-- Custom Script -->
	<script src="lib/app.js" type="text/javascript"></script>
	<script src="lib/dashboard.js"></script>
</body>

</html>